#!/usr/bin/env python3
"""
–ü—Ä–æ–µ–∫—Ç 4: –®–∏—Ñ—Ä –¶–µ–∑–∞—Ä—è

–ø—Ä–æ–≥—Ä–∞–º–º–∞, —Å–ø–æ—Å–æ–±–Ω–∞—é —à–∏—Ñ—Ä–æ–≤–∞—Ç—å –∏ –¥–µ—à–∏—Ñ—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –∞–ª–≥–æ—Ä–∏—Ç–º–æ–º –¶–µ–∑–∞—Ä—è. 
–û–Ω–∞ –¥–æ–ª–∂–Ω–∞ –∑–∞–ø—Ä–∞—à–∏–≤–∞—Ç—å —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å–ª–µ–¥—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ:
–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –∏–ª–∏ –¥–µ—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ;
—è–∑—ã–∫ –∞–ª—Ñ–∞–≤–∏—Ç–∞: —Ä—É—Å—Å–∫–∏–π –∏–ª–∏ –∞–Ω–≥–ª–∏–π—Å–∫–∏–π;
—à–∞–≥ —Å–¥–≤–∏–≥–∞ (—Å–æ —Å–¥–≤–∏–≥–æ–º –≤–ø—Ä–∞–≤–æ).
"""

rus_lower = "–∞–±–≤–≥–¥–µ–∂–∑–∏–π–∫–ª–º–Ω–æ–ø—Ä—Å—Ç—É—Ñ—Ö—Ü—á—à—â—ä—ã—å—ç—é—è"
rus_upper = rus_lower.upper()
eng_lower = "abcdefghijklmnopqrstuvwxyz"
eng_upper = eng_lower.upper()

#1. —Ñ—É–Ω–∫—Ü–∏—è –∫–æ–¥–∏—Ä–æ–≤–∫–∏ –¥–ª—è —Ä—É—Å—Å–∫–æ–≥–æ –∏ –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ –∞–ª—Ñ–∞–≤–∏—Ç–∞
def text_encryption(text, key):
    # —Å–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é —Å—Ç—Ä–æ–∫—É –¥–ª—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
    new_text = ''
    # –∏–¥–µ–º –ø–æ –∫–∞–∂–¥–æ–º—É —Å–∏–º–≤–æ–ª—É –≤ –∏—Å—Ö–æ–¥–Ω–æ–º —Ç–µ–∫—Å—Ç–µ –∏ —Å–≤–µ—Ä—è–µ–º –∫ –∫–∞–∫–æ–π –∫–æ–Ω—Å—Ç–∞–Ω—Ç–µ (rus_lower,..., eng_upper) –æ–Ω –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç
    for char in text:
        if char in rus_upper:
            new_index = (rus_upper.index(char) + key) % 32        # %32 –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Ü–∏–∫–ª–∏—á–Ω–æ—Å—Ç—å(—ë –∏—Å–∫–ª—é—á–∞–µ–º –≤ –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ) –¥–ª—è —Ü–∏–∫–ª–∏—á–Ω–æ—Å—Ç–∏
            new_text += rus_upper[new_index]
        elif char in rus_lower:
            new_index = (rus_lower.index(char) + key) % 32
            new_text += rus_lower[new_index]
        elif char in eng_upper:
            new_index = (eng_upper.index(char) + key) % 26        # %26 –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Ü–∏–∫–ª–∏—á–Ω–æ—Å—Ç—å (z ‚Üí a)
            new_text += eng_upper[new_index]
        elif char in eng_lower:
            new_index = (eng_lower.index(char) + key) % 26
            new_text += eng_lower[new_index]
        else:
            new_text += char
    return new_text
"""
# –í–≤–æ–¥–∏–º –∏—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Ç–µ–∫—Å—Ç –¥—è–ª —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è –∏ –∫–ª—é—á            
text = input(f'–ü–æ–∂–∞–ª—É–π—Å—Ç–∞ –≤–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è –∫–æ–¥–∏—Ä–æ–≤–∫–∏ –Ω–∞ —Ä—É—Å—Å–∫–æ–º –∏–ª–∏ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º:_ ')
key = int(input(f'–ü–æ–∂–∞–ª—É–π—Å—Ç–∞ –≤–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–æ - –∫–ª—é—á:_'))
# –í—ã–≤–æ–¥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
print(text_encryption(text, key))"""

#2. —Ñ—É–Ω–∫—Ü–∏—è –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∫–∏ –¥–ª—è —Ä—É—Å—Å–∫–æ–≥–æ –∏ –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ –∞–ª—Ñ–∞–≤–∏—Ç–∞
def text_decoding(text, key):
    # —Å–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é —Å—Ç—Ä–æ–∫—É –¥–ª—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
    old_text = ''
    for char in text:
        if char in rus_upper:
            new_index = (rus_upper.index(char) - key) % 32
            old_text += rus_upper[new_index]
        elif char in rus_lower:
            new_index = (rus_lower.index(char) - key) % 32
            old_text += rus_lower[new_index]
        elif char in eng_upper:
            new_index = (eng_upper.index(char) - key) % 26
            old_text += eng_upper[new_index]
        elif char in eng_lower:
            new_index = (eng_lower.index(char) - key) % 26
            old_text += eng_lower[new_index]
        else:
            old_text += char
    return old_text
            
"""# –í–≤–æ–¥–∏–º –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç –∏ –∫–ª—é—á            
text = input(f'–ü–æ–∂–∞–ª—É–π—Å—Ç–∞ –≤–≤–µ–¥–∏—Ç–µ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç:_ ')
key = int(input(f'–ü–æ–∂–∞–ª—É–π—Å—Ç–∞ –≤–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–æ - –∫–ª—é—á:_'))
# –í—ã–≤–æ–¥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
print(text_encryption(text, key))"""


#3. —Ñ—É–Ω–∫—Ü–∏—è –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∫–∏ –¥–ª—è –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ –∞–ª—Ñ–∞–≤–∏—Ç–∞ –µ—Å–ª–∏ –Ω–µ–∏–∑–≤–µ—Å—Ç–µ–Ω –∫–ª—é—á
def text_decoding_eng(text):
        
    for n in range(0, 26):
        # –∫–∞–∂–¥—ã–π —Ä–∞–∑ —Å–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é —Å—Ç—Ä–æ–∫—É –¥–ª—è —Ä–µ–∑—É–ª—å–∞—Ç–∞—Ç       
        old_text = ''

        for char in text:
            if char in eng_upper:
                new_index = (eng_upper.index(char) - n) % 26
                old_text += eng_upper[new_index]
            elif char in eng_lower:
                new_index = (eng_lower.index(char) - n) % 26
                old_text += eng_lower[new_index]
            else:
                old_text += char

        print(n, old_text, end='\n')

# –í–≤–æ–¥–∏–º –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç      
"""text = input()
# –í—ã–≤–æ–¥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
print(text_decoding_eng(text))"""   # –≤—ã–≤–æ–¥ –±—É–¥–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –≤—Å–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –∫–ª—é—á–∞


#3. —Ñ—É–Ω–∫—Ü–∏—è –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∫–∏ –¥–ª—è —Ä—É—Å—Å–∫–æ–≥–æ –∞–ª—Ñ–∞–≤–∏—Ç–∞ –µ—Å–ª–∏ –Ω–µ–∏–∑–≤–µ—Å—Ç–µ–Ω –∫–ª—é—á(–ø–æ–¥–±–æ—Ä)
def text_decoding_rus(text):
    
    
    for n in range(0, 33):
        # –∫–∞–∂–¥—ã–π —Ä–∞–∑ —Å–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é —Å—Ç—Ä–æ–∫—É –¥–ª—è —Ä–µ–∑—É–ª—å–∞—Ç–∞—Ç       
        old_text = ''

        for char in text:
            if char in rus_upper:
                new_index = (rus_upper.index(char) - n) % 32
                old_text += rus_upper[new_index]
            elif char in rus_lower:
                new_index = (rus_lower.index(char) - n) % 32
                old_text += rus_lower[new_index]
            else:
                old_text += char

        print(n, old_text, end='\n')

# –í–≤–æ–¥–∏–º –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç             
"""text = input()
# –í—ã–≤–æ–¥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
print(text_decoding_rus(text))"""   # –≤—ã–≤–æ–¥ –±—É–¥–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –≤—Å–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –∫–ª—é—á–∞


print("=== –ó–∞–¥–∞—á–∞: –ê–≤–µ, –¶–µ–∑–∞—Ä—å üå∂Ô∏è")
"""–ù–∞ –≤—Ö–æ–¥ –ø—Ä–æ–≥—Ä–∞–º–º–µ –ø–æ–¥–∞—ë—Ç—Å—è —Å—Ç—Ä–æ–∫–∞ —Ç–µ–∫—Å—Ç–∞ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º —è–∑—ã–∫–µ, –≤ –∫–æ—Ç–æ—Ä–æ–π –Ω—É–∂–Ω–æ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞—Ç—å –≤—Å–µ —Å–ª–æ–≤–∞. 
–ö–∞–∂–¥–æ–µ —Å–ª–æ–≤–æ —Å—Ç—Ä–æ–∫–∏ —Å–ª–µ–¥—É–µ—Ç –∑–∞—à–∏—Ñ—Ä–æ–≤–∞—Ç—å —Å –ø–æ–º–æ—â—å—é —à–∏—Ñ—Ä–∞ –¶–µ–∑–∞—Ä—è (—Ü–∏–∫–ª–∏—á–µ—Å–∫–æ–≥–æ —Å–¥–≤–∏–≥–∞ –Ω–∞ –¥–ª–∏–Ω—É —ç—Ç–æ–≥–æ —Å–ª–æ–≤–∞). 
–°—Ç—Ä–æ—á–Ω—ã–µ –±—É–∫–≤—ã –ø—Ä–∏ —ç—Ç–æ–º –æ—Å—Ç–∞—é—Ç—Å—è —Å—Ç—Ä–æ—á–Ω—ã–º–∏, –∞ –ø—Ä–æ–ø–∏—Å–Ω—ã–µ ‚Äì –ø—Ä–æ–ø–∏—Å–Ω—ã–º–∏. –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç—Å—è, —á—Ç–æ –º–µ–∂–¥—É —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ 
—Å–ª–æ–≤–∞–º–∏ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç –æ–¥–∏–Ω –ø—Ä–æ–±–µ–ª."""

def count_letters(word):
    """–í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è: —Å—á–∏—Ç–∞–µ—Ç –±—É–∫–≤—ã –≤ —Å–ª–æ–≤–µ"""
    return sum(1 for char in word if char.isalpha())

def text_encryption_hard(text):
    #1. —Å–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é —Å—Ç—Ä–æ–∫—É –¥–ª—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
    new_text = ''
    # –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ–º —Å—Ç—Ä–æ–∫—É –≤ —Å–ø–∏—Å–æ–∫ –∏ —Ä–∞–∑–±–∏–≤–∞–µ–º –ø–æ –ø—Ä–æ–±–µ–ª–∞–º —Å –ø–æ–º–æ—â—å—é split(' ')
    words = text.split(' ')
    # —Å–æ–∑–¥–∞–µ–º —Å–ø–∏—Å–æ–∫ –≤ –∫–æ—Ç–æ—Ä–æ–º –±—É–¥—É—Ç –∫–ª—é—á–∏ –¥–ª—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è –∫–∞–∂–¥–æ–≥–æ —Å–ª–æ–≤–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—É—é —Ñ-–∏—é def count_letters
    keys = [count_letters(word) for word in words]

    #2. –∏–¥–µ–º –ø–æ –∫–∞–∂–¥–æ–º—É —Å–ª–æ–≤—É –∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–ª–æ–≤–∞ –ø—Ä–∏–º–µ–Ω—è–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –∫–ª—é—á –∏–∑ keys
    for i in range(len(words)):                  # words[i] - –æ—Ç–¥–µ–ª—å–Ω–æ–µ —Å–ª–æ–≤–æ –≤ —Å–ø–∏—Å–∫–µ, i - –∏–Ω–¥–µ–∫—Å —ç—Ç–æ–≥–æ —Å–ª–æ–≤–∞

        for char in words[i]:                       # char - –∏–Ω–¥–µ–∫—Å —Å–∏–º–≤–æ–ª–∞ –≤ —Å–ª–æ–≤–µ words[i]
            if char in eng_upper:         
                # keys[i] –≤—Å—Ç–∞–≤–ª—è–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –∫–ª—é—á
                new_index = (eng_upper.index(char) + keys[i]) % 26        
                new_text += eng_upper[new_index]
            elif char in eng_lower:         
                # %26 –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Ü–∏–∫–ª–∏—á–Ω–æ—Å—Ç—å (z ‚Üí a)
                new_index = (eng_lower.index(char) + keys[i]) % 26        
                new_text += eng_lower[new_index]
            else:
                new_text += char
        # –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —Å–ª–æ–≤–∞ –¥–æ–±–∞–≤–ª—è–µ–º –ø—Ä–æ–±–µ–ª
        new_text += ' '

    return new_text.rstrip()

# –≤–≤–æ–¥–∏–º –∏—Å—Ö–æ–¥–Ω—É—é —Å—Ç—Ä–æ–∫—É, –∫–æ—Ç–æ—Ä—É—é –Ω—É–∂–Ω–æ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞—Ç—å
text = input()
# –í—ã–≤–æ–¥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
print(text_encryption_hard(text))


